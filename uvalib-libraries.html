<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../app-route/app-location.html">
<link rel="import" href="uvalib-library.html">
<link rel="import" href="../uvalib-models/uvalib-model-libraries.html">

<!--
`uvalib-libraries`
ui component that displays a listing of UVA libraries

@demo demo/index.html
@demo demo/listing.html
-->

<dom-module id="uvalib-libraries">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <app-location path="{{_anchor}}" use-hash-as-path></app-location>

    <h2>Anchor: [[_anchor]]</h2>

    <template is="dom-if" if="{{uuid}}" restamp>
      <uvalib-model-libraries data="{{data}}" filter="{{_filter}}"/>
    </template>
    <template is="dom-if" if="{{library}}" restamp>
      <uvalib-model-libraries data="{{data}}" filter="{{_filter}}"/>
    </template>
    <template is="dom-if" if="{{_dataPassed(uuid,library)}}" restamp>
      <uvalib-model-libraries data="{{data}}"/>
    </template>

    <template is="dom-repeat" items="{{data}}" as="lib">
      <a id="[[lib.slug]]"></a>
      <uvalib-library object="[[lib]]"></uvalib-library>
    </template>
  </template>

  <script>
    Polymer({
      is: 'uvalib-libraries',

      properties: {
        /**
         * The uuid of the Library.  If specified will define which Library is being requested (takes priority over the library property)
         */
        uuid: {
          type: String,
          value: null
        },
        /**
         * The library that is being requested.  If the uuid property is not specified and the library property is, then this is used to define which Library is being requested.
         */
        library: {
          value: null,
          type: String,
        },
        /**
         * Data parsed to generate one or more library/lab content types.
         */
        data: {
          value: null,
          type: Array,
          observer: "_dataChanged"
        },
        _filter: {
          type: Object,
          computed: '_makeFilter(uuid,library)'
        },
        /**
         * Anchors will scroll into view if true
         */
        anchorsEnabled: {
          type: Boolean,
          value: false
        },
        _anchor: {
          type: String,
          observer: '_anchorChanged'
        }

      },

      _dataChanged: function(){
        if( this.anchorsEnabled ) {
          this.debounce('datachange',function(){
            this._jumpToAnchor();
          },500);
        }
      },

      _dataPassed: function(uuid,library) {
        if (!uuid && !library) {
          return 1;
        } else {
          return 0;
        }
      },

      _makeFilter: function(uuid,title) {
        if (uuid) {
          return {uuid: uuid};
        } else if (title) {
          return {title: title};
        } else return {};
      },

      _anchorChanged: function(){
        if( this.anchorsEnabled ) {
          console.log('anchor changed to '+this._anchor);
          this._jumpToAnchor();
        }
      },

      _jumpToAnchor: function(){
        if(this._anchor)
          this.$$('#'+this._anchor).scrollIntoView();
      }

    });
  </script>
</dom-module>
